<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор Мякоти</title>
    <style>
        :root {
            --dark-bg: #121212;
            --darker-bg: #0a0a0a;
            --text-color: #ffffff;
            --accent-color: #6c5ce7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--darker-bg);
            border-radius: 10px;
        }

        .nav-button {
            padding: 12px 24px;
            border: 2px solid transparent;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background-color: rgba(30, 30, 30, 0.8);
            position: relative;
            overflow: hidden;
            color: white;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                #ff0000, #ff7700, #ffff00, 
                #00ff00, #0000ff, #8000ff, #ff0000);
            z-index: -1;
            transition: left 0.6s ease;
        }

        .nav-button:hover::before {
            left: 0;
        }

        .nav-button.active {
            background: linear-gradient(90deg, 
                #ff0000, #ff7700, #ffff00, 
                #00ff00, #0000ff, #8000ff, #ff0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content {
            display: none;
            padding: 20px;
            background-color: var(--darker-bg);
            border-radius: 10px;
        }

        .content.active {
            display: block;
        }

        .calculator-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .meat-block {
            background-color: rgba(35, 35, 35, 0.8);
            padding: 20px;
            border-radius: 10px;
            width: 220px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .meat-block:hover {
            transform: translateY(-5px);
        }

        .meat-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #e0e0e0;
        }

        .meat-placeholder {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            border-radius: 8px;
        }

        .red { background-color: #e14b4b; }
        .blue { background-color: #3b82f6; }
        .yellow { background-color: #f59f00; }
        .white { background-color: #d1d5db; }

        .input-group {
            margin: 12px 0;
        }

        .input-label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            color: #bbb;
        }

        .price-input, .quantity-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #222;
            color: var(--text-color);
            font-size: 14px;
        }

        .price-input:focus, .quantity-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .result {
            margin-top: 12px;
            font-size: 16px;
            color: #6c5ce7;
            min-height: 24px;
        }

        .finish-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(90deg, 
                #ff0000, #ff7700, #ffff00, 
                #00ff00, #0000ff, #8000ff, #ff0000);
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .report-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            color: #ddd;
        }

        .report-table th, .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .report-table th {
            background-color: rgba(50, 50, 50, 0.6);
        }

        .summary {
            background-color: rgba(50, 50, 50, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .profit {
            color: #2ecc71;
            font-weight: bold;
        }

        .loss {
            color: #e74c3c;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header {
                flex-wrap: wrap;
            }
            .meat-block {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <button class="nav-button active" id="buy-mode">Калькулятор Покупок</button>
    <button class="nav-button" id="sell-mode">Калькулятор Продаж</button>
    <button class="nav-button" id="report-mode">Отчет</button>
</div>

<div class="content active" id="buy-calculator">
    <div class="calculator-container">
        <div class="meat-block" data-type="red">
            <div class="meat-title">Мякоть куборбуза</div>
            <div class="meat-placeholder red"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (покупка)</label>
                <input type="number" class="price-input" value="10" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>

        <div class="meat-block" data-type="blue">
            <div class="meat-title">Мякоть сластены</div>
            <div class="meat-placeholder blue"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (покупка)</label>
                <input type="number" class="price-input" value="12" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>

        <div class="meat-block" data-type="yellow">
            <div class="meat-title">Мякоть лимонника</div>
            <div class="meat-placeholder yellow"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (покупка)</label>
                <input type="number" class="price-input" value="9" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>

        <div class="meat-block" data-type="white">
            <div class="meat-title">Мякоть солевика</div>
            <div class="meat-placeholder white"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (покупка)</label>
                <input type="number" class="price-input" value="8" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>
    </div>
    <button class="finish-button" id="finish-buy">Завершить расчёт покупок</button>
</div>

<div class="content" id="sell-calculator">
    <div class="calculator-container">
        <div class="meat-block" data-type="red">
            <div class="meat-title">Мякоть куборбуза</div>
            <div class="meat-placeholder red"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (продажа)</label>
                <input type="number" class="price-input" value="15" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>

        <div class="meat-block" data-type="blue">
            <div class="meat-title">Мякоть сластены</div>
            <div class="meat-placeholder blue"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (продажа)</label>
                <input type="number" class="price-input" value="18" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>

        <div class="meat-block" data-type="yellow">
            <div class="meat-title">Мякоть лимонника</div>
            <div class="meat-placeholder yellow"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (продажа)</label>
                <input type="number" class="price-input" value="14" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>

        <div class="meat-block" data-type="white">
            <div class="meat-title">Мякоть солевика</div>
            <div class="meat-placeholder white"></div>
            <div class="input-group">
                <label class="input-label">Цена за шт (продажа)</label>
                <input type="number" class="price-input" value="12" min="0" step="0.01">
            </div>
            <div class="input-group">
                <label class="input-label">Количество</label>
                <input type="number" class="quantity-input" placeholder="0" min="0">
            </div>
            <div class="result" data-result></div>
        </div>
    </div>
    <button class="finish-button" id="finish-sell">Завершить расчёт продаж</button>
</div>

<div class="content" id="report-view">
    <div class="report-container">
        <h2 style="text-align:center;margin-bottom:20px;">Отчёт по мякоти</h2>
        <table class="report-table">
            <thead>
                <tr>
                    <th>Тип мякоти</th>
                    <th>Куплено (шт)</th>
                    <th>Потрачено (₽)</th>
                    <th>Продано (шт)</th>
                    <th>Заработано (₽)</th>
                </tr>
            </thead>
            <tbody id="report-body">
                <tr><td>Мякоть куборбуза</td><td id="bought-red">0</td><td id="cost-red">0.00</td><td id="sold-red">0</td><td id="income-red">0.00</td></tr>
                <tr><td>Мякоть сластены</td><td id="bought-blue">0</td><td id="cost-blue">0.00</td><td id="sold-blue">0</td><td id="income-blue">0.00</td></tr>
                <tr><td>Мякоть лимонника</td><td id="bought-yellow">0</td><td id="cost-yellow">0.00</td><td id="sold-yellow">0</td><td id="income-yellow">0.00</td></tr>
                <tr><td>Мякоть солевика</td><td id="bought-white">0</td><td id="cost-white">0.00</td><td id="sold-white">0</td><td id="income-white">0.00</td></tr>
            </tbody>
        </table>
        <div class="summary">
            <div class="summary-item">
                <span>Всего потрачено:</span>
                <span id="total-cost">0.00 ₽</span>
            </div>
            <div class="summary-item">
                <span>Всего заработано:</span>
                <span id="total-income">0.00 ₽</span>
            </div>
            <div class="summary-item">
                <span>Прибыль / Убыток:</span>
                <span id="profit-loss">0.00 ₽</span>
            </div>
        </div>
    </div>
</div>

<script>
    // Инициализация данных
    let report = {
        red: { bought: 0, cost: 0, sold: 0, income: 0 },
        blue: { bought: 0, cost: 0, sold: 0, income: 0 },
        yellow: { bought: 0, cost: 0, sold: 0, income: 0 },
        white: { bought: 0, cost: 0, sold: 0, income: 0 }
    };

    // Загрузка цен из localStorage
    function loadPrices() {
        const buyInputs = document.querySelectorAll('#buy-calculator .price-input');
        const sellInputs = document.querySelectorAll('#sell-calculator .price-input');
        const types = ['red', 'blue', 'yellow', 'white'];
        
        types.forEach((type, i) => {
            const buyPrice = localStorage.getItem(buyPrice_${type});
            const sellPrice = localStorage.getItem(sellPrice_${type});
            if (buyPrice !== null) buyInputs[i].value = buyPrice;
            if (sellPrice !== null) sellInputs[i].value = sellPrice;
        });
    }

    // Сохранение цен
    function savePrice(type, mode, value) {
        localStorage.setItem(${mode}Price_${type}, value);
    }

    // Обновление отображения общего итога в калькуляторе
    function updateTotal(mode) {
        const container = document.getElementById(${mode}-calculator);
        const blocks = container.querySelectorAll('.meat-block');
        let total = 0;

        blocks.forEach(block => {
            const qtyInput = block.querySelector('.quantity-input');
            const priceInput = block.querySelector('.price-input');
            const qty = parseFloat(qtyInput.value) || 0;
            const price = parseFloat(priceInput.value) || 0;
            total += qty * price;
        });

        // Найдём или создадим блок с общим итогом
        let totalEl = container.querySelector('.total-result');
        if (!totalEl) {
            totalEl = document.createElement('div');
            totalEl.className = 'total-result';
            totalEl.style.cssText = 'margin-top: 25px; font-size: 20px; font-weight: bold; color: #6c5ce7; text-align: center;';
            container.appendChild(totalEl);
        }
        totalEl.textContent = Общая сумма: ${total.toFixed(2)} ₽;
    }

    // Сброс количества
    function resetQuantity(block) {
        const qtyInput = block.querySelector('.quantity-input');
        qtyInput.value = '';
        block.querySelector('[data-result]').textContent = '';
    }

    // Установка обработчиков для калькулятора
    function setupCalculator(mode) {
        const container = document.getElementById(${mode}-calculator);
        const inputs = container.querySelectorAll('.quantity-input');
        const priceInputs = container.querySelectorAll('.price-input');

        const update = () => updateTotal(mode);

        inputs.forEach(input => {
            input.addEventListener('input', update);
        });

        priceInputs.forEach(input => {
            input.addEventListener('input', update);
            input.addEventListener('change', () => {
                savePrice(input.closest('.meat-block').dataset.type, mode, input.value);
            });
        });

        // Инициализация общего итога
        update();
    }

    // Завершение расчёта
    function finishCalculation(mode) {
        const container = document.getElementById(${mode}-calculator);
        const blocks = container.querySelectorAll('.meat-block');
        const types = ['red', 'blue', 'yellow', 'white'];

        blocks.forEach((block, i) => {
            const type = types[i];
            const qtyInput = block.querySelector('.quantity-input');
            const priceInput = block.querySelector('.price-input');
            const qty = parseFloat(qtyInput.value) || 0;
            const price = parseFloat(priceInput.value) || 0;
             if (qty > 0) {
                if (mode === 'buy') {
                    report[type].bought += qty;
                    report[type].cost += qty * price;
                } else {
                    report[type].sold += qty;
                    report[type].income += qty * price;
                }
                resetQuantity(block);
            }
        });

        updateReport();
        saveReport();
        // Обновить общий итог (теперь он будет 0.00)
        updateTotal(mode);
    }

    // Обновление отчёта
    function updateReport() {
        const fields = ['bought', 'cost', 'sold', 'income'];
        const types = ['red', 'blue', 'yellow', 'white'];
        let totalCost = 0, totalIncome = 0;

        types.forEach(type => {
            fields.forEach(field => {
                const el = document.getElementById(${field}-${type});
                if (el) {
                    el.textContent = report[type][field].toFixed(field === 'cost' || field === 'income' ? 2 : 0);
                }
            });
            totalCost += report[type].cost;
            totalIncome += report[type].income;
        });

        document.getElementById('total-cost').textContent = totalCost.toFixed(2) + ' ₽';
        document.getElementById('total-income').textContent = totalIncome.toFixed(2) + ' ₽';
        const profit = totalIncome - totalCost;
        const profitEl = document.getElementById('profit-loss');
        profitEl.textContent = profit.toFixed(2) + ' ₽';
        profitEl.className = profit >= 0 ? 'profit' : 'loss';
    }

    // Сохранение отчёта
    function saveReport() {
        localStorage.setItem('meatReport', JSON.stringify(report));
    }

    // Загрузка отчёта
    function loadReport() {
        const saved = localStorage.getItem('meatReport');
        if (saved) {
            report = JSON.parse(saved);
        }
        updateReport();
    }

    // Переключение вкладок
    document.querySelectorAll('.nav-button').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            const mode = btn.id.replace('-mode', '');
            if (mode === 'report') {
                document.getElementById('report-view').classList.add('active');
            } else {
                document.getElementById(${mode}-calculator).classList.add('active');
            }
        });
    });

    // Кнопки завершения
    document.getElementById('finish-buy').addEventListener('click', () => finishCalculation('buy'));
    document.getElementById('finish-sell').addEventListener('click', () => finishCalculation('sell'));

    // Инициализация
    loadPrices();
    loadReport();
    setupCalculator('buy');
    setupCalculator('sell');
</script>

    // Автообновление при вводе — уже реализовано в setupCalculator через 'input' event
</script>

</body>
</html>
